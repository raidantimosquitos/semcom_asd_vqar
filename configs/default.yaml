# Default config. Override with --config path or CLI.
# Run: python -m src.main --config configs/default.yaml --mode train
#      python -m src.main --config configs/default.yaml --mode eval
#
# Checkpoint layout:
#   checkpoints/
#   ├── models/     # VQ-VAE and PixelSNAIL prior .pth
#   └── stats/      # {appliance}_train_stats.pt (precomputed mean/std)

mode: train  # train | eval

checkpoints:
  dir: "checkpoints"

data:
  root_dir: "/mnt/ssd/LaCie/dcase2020-task2-dev-dataset"
  appliance: fan
  test_size: 0.1
  batch_size: 8
  random_state: 42
  # Max samples for computing dataset mean/std (null = use all)
  max_samples_stats: null

device: cuda  # cuda | cpu

# Phase 1: VQ-VAE (optionally 3 sub-phases with MachineID classifier)
phase1:
  num_epochs: 10  # used only when phase1a_epochs not set (single-phase VQ-VAE only)
  # Three-phase schedule: 1a = VQ-VAE only, 1b = VQ-VAE + classifier, 1c = frozen codebook + recon + classifier
  phase1a_epochs: null  # e.g. 30; null = use num_epochs and skip 1b/1c
  phase1b_epochs: null  # e.g. 50
  phase1c_epochs: null  # e.g. 20
  lambda_1: 1.0   # weight for VQ-VAE loss (recon + vq)
  lambda_2: 0.5   # weight for machine_id classifier CE loss (phases 1b/1c)
  lr: 0.001
  checkpoint: "checkpoints/models/mobilenetv2_8x_vqvae.pth"
  classifier_checkpoint: "checkpoints/models/machine_id_classifier.pth"

# Phase 2: PixelSNAIL prior (after VQ-VAE)
phase2:
  num_epochs: 20
  lr: 0.0001
  checkpoint: "checkpoints/models/pixelsnail_prior.pth"

# Evaluation (used when mode: eval)
eval:
  vqvae_checkpoint: "checkpoints/models/mobilenetv2_8x_vqvae.pth"
  prior_checkpoint: "checkpoints/models/pixelsnail_prior.pth"

# Logging
logging:
  log_dir: "logs"
  name: "main"
